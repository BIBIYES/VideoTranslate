# è§†é¢‘å­—å¹•å·¥å…·ç®±ä½¿ç”¨æŒ‡å—

ğŸ“˜ [English guide](README.en.md)

æœ¬é¡¹ç›®æä¾›åŸºäº faster-whisper çš„ **è§†é¢‘è½¬å­—å¹•**ã€åŸºäº ffmpeg çš„ **å­—å¹•çƒ§å½•**ï¼Œä»¥åŠåŸºäº OpenAI æ¨¡å‹çš„ **AI å­—å¹•ç¿»è¯‘**ã€‚æ—¢å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Streamlit Web é¡µé¢æ“ä½œã€‚

## Streamlit ç•Œé¢ä¸€è§ˆ

ä¸‹å›¾å±•ç¤º Streamlit åº”ç”¨ä¸‰ä¸ª Tab çš„å…¸å‹ UIï¼Œå¯ç›´æ¥åœ¨ GitHub æˆ–ä»»ä½•æ”¯æŒ Markdown çš„å¹³å°ä¸Šé¢„è§ˆã€‚

![è§†é¢‘è½¬å­—å¹• Tab](assets/VideoToSrt.png)

![å­—å¹•çƒ§å½• Tab](assets/SubtitleBurning.png)

![AI å­—å¹•ç¿»è¯‘ Tab](assets/AI-SubtitleTranslation.png)

## 1. ç¯å¢ƒå‡†å¤‡

1. macOS / Linux / Windowsï¼ˆCLI éƒ¨åˆ†ï¼‰ï¼Œç¤ºä¾‹ä»¥ macOS ä¸ºä¸»ã€‚  
2. å®‰è£… Python 3.9+ï¼Œå¹¶å‡†å¤‡è™šæ‹Ÿç¯å¢ƒï¼š
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```
3. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```
   å¦‚æœæ²¡æœ‰ requirementsï¼Œå¯æ‰§è¡Œï¼š
   ```bash
   pip install faster-whisper streamlit openai
   ```
4. å®‰è£… ffmpegï¼ˆç”¨äºæå–éŸ³é¢‘ã€çƒ§å½•å­—å¹•ï¼‰ï¼š
   ```bash
   brew install ffmpeg      # macOS
   # æˆ–è€…ä» https://ffmpeg.org/ ä¸‹è½½äºŒè¿›åˆ¶
   ```
5. é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä» Hugging Face ä¸‹è½½å®‰è£…æ¨¡å‹ï¼Œé»˜è®¤ç¼“å­˜ç›®å½•ä¸º `~/.cache/huggingface/hub`ã€‚

## 2. å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆmian.pyï¼‰

1. åŸºæœ¬ç”¨æ³•ï¼š
   ```bash
   python mian.py /path/to/video.mp4 \
       --model-size base \
       --language zh \
       --device auto \
       --compute-type float32
   ```
2. å¸¸ç”¨å‚æ•°ï¼š
   - `--model-size`ï¼šfaster-whisper æ¨¡å‹åç§°æˆ–æœ¬åœ°è·¯å¾„ï¼ˆtiny/base/small/medium/large-v3ï¼‰ã€‚
   - `--language`ï¼šISO 639-1 è¯­è¨€ä»£ç ï¼Œå¦‚ `zh`ã€`en`ã€`ja`ï¼›ä¸ºç©ºæ—¶è‡ªåŠ¨æ£€æµ‹ã€‚
   - `--device`ï¼š`auto` / `cpu` / `cuda` / `metal`ã€‚
   - `--compute-type`ï¼š`int8_float16` / `int8` / `float16` / `float32`ï¼ˆå…¼å®¹æ€§æœ€å¥½ï¼‰ã€‚
   - `--no-vad`ï¼šå–æ¶ˆé™éŸ³æ£€æµ‹ã€‚
3. è¾“å‡ºï¼šä¸è¾“å…¥è§†é¢‘åŒç›®å½•ç”Ÿæˆ `.srt` å­—å¹•æ–‡ä»¶ã€‚

## 3. Streamlit Web ç•Œé¢

1. å¯åŠ¨ï¼š
   ```bash
   streamlit run streamlit_app.py
   ```
2. é¡µé¢åŒ…å«ä¸‰ä¸ª Tabï¼š

   | åŠŸèƒ½ | è¯´æ˜ |
   | --- | --- |
   | ğŸ¯ è§†é¢‘è½¬å­—å¹• | ä¸Šä¼ è§†é¢‘/éŸ³é¢‘ï¼Œé€‰æ‹©æ¨¡å‹å’Œè¯­è¨€ï¼Œå®æ—¶æ—¥å¿—å±•ç¤ºæå–éŸ³é¢‘ã€æ¨¡å‹ä¸‹è½½ã€è¯†åˆ«è¿‡ç¨‹ï¼Œå¯ä¸‹è½½ SRT å¹¶é¢„è§ˆã€‚|
   | ğŸ”¥ å­—å¹•çƒ§å½• | ä¸Šä¼ è§†é¢‘ + SRTï¼Œè®¾ç½®å­—ä½“æˆ– `force_style`ï¼Œè°ƒç”¨ ffmpeg ç”ŸæˆåµŒå…¥å­—å¹•çš„è§†é¢‘ï¼Œæ”¯æŒè¿›åº¦æ¡å’Œæ—¥å¿—ã€‚|
   | ğŸ§  AI å­—å¹•ç¿»è¯‘ | ä¸Šä¼  SRTï¼Œå¡«å†™ OpenAI æ¥å£åœ°å€å’Œ Keyï¼Œé€‰æ‹©æ¨¡å‹ä¸ç›®æ ‡è¯­è¨€ï¼ŒæŒ‰å°æ‰¹é‡è¯·æ±‚ç¿»è¯‘å¹¶å¯¼å‡ºæ–°çš„ SRTã€‚|

3. AI ç¿»è¯‘è¯´æ˜ï¼š
   - éœ€è¦å…¼å®¹ OpenAI æ ¼å¼çš„æ¥å£ï¼Œä¾‹å¦‚å®˜æ–¹ API æˆ–ç¬¬ä¸‰æ–¹ä»£ç†ã€‚
- `API Base` å½¢å¦‚ `https://api.openai.com/v1`ï¼Œ`API Key` åªåœ¨æœ¬æ¬¡ä¼šè¯ä¸­ä½¿ç”¨ã€‚
- `æ¨¡å‹åç§°` å¯å¡«å†™ `gpt-4o-mini`ã€`gpt-4o-mini-translation` ç­‰ã€‚
- `æ¯æ‰¹ç¿»è¯‘çš„å­—å¹•æ¡æ•°` ä»¥åŠâ€œå¹¶å‘è¯·æ±‚æ•°â€éƒ½å¯åœ¨é¡µé¢ä¸­è°ƒèŠ‚ï¼Œæ–¹ä¾¿åœ¨é€Ÿåº¦ä¸ç¨³å®šæ€§ä¹‹é—´å¹³è¡¡ã€‚

### ç•Œé¢ç¤ºæ„å›¾

ä¸‹å›¾å±•ç¤º Streamlit ä¸‰ä¸ª Tab çš„æ ¸å¿ƒäº¤äº’åŒºåŸŸï¼Œå¯ä»¥ç›´æ¥åœ¨ GitHub æˆ– Streamlit çš„ Markdown é¢„è§ˆé‡Œæ˜¾ç¤ºã€‚

![è§†é¢‘è½¬å­—å¹• Tab](assets/VideoToSrt.png)

![å­—å¹•çƒ§å½• Tab](assets/SubtitleBurning.png)

![AI å­—å¹•ç¿»è¯‘ Tab](assets/AI-SubtitleTranslation.png)

## 4. å¸¸è§é—®é¢˜

1. **æ¨¡å‹ä¸‹è½½å¤ªæ…¢/æ— è¿›åº¦**ï¼šæ—¥å¿—ä¼šæç¤ºâ€œåŠ è½½ / ä¸‹è½½æ¨¡å‹â€ï¼Œä½†æ²¡æœ‰è¯¦ç»†ç™¾åˆ†æ¯”ã€‚å¯æå‰ä½¿ç”¨ Hugging Face CLI ä¸‹è½½æ¨¡å‹ï¼Œå¹¶åœ¨ CLI çš„ `--model-size` æˆ– Web ç•Œé¢â€œè‡ªå®šä¹‰æ¨¡å‹/æœ¬åœ°è·¯å¾„â€ä¸­å¡«å…¥æœ¬åœ°ç›®å½•ä»¥é¿å…é‡å¤ä¸‹è½½ã€‚
2. **`ffmpeg failed to extract audio`**ï¼šè¾“å…¥è§†é¢‘å¯èƒ½æ²¡æœ‰éŸ³é¢‘æµã€‚å¯å…ˆç”¨ `ffprobe your_video.mp4` æ£€æŸ¥æ˜¯å¦å­˜åœ¨ `Stream #0:1: Audio`ï¼›è‹¥æ— é¡»é‡æ–°ç”Ÿæˆå¸¦éŸ³è½¨çš„è§†é¢‘ã€‚
3. **`Requested int8_float16 compute type...`**ï¼šå½“å‰è®¾å¤‡ä¸æ”¯æŒ `int8_float16`ã€‚æ”¹ç”¨ `--compute-type float32` æˆ– `int8`ã€‚
4. **ä»£ç†ç¯å¢ƒæç¤ºç¼ºå°‘ socksio**ï¼šå®‰è£… `pip install "httpx[socks]"`ï¼Œç¡®ä¿ httpx æ”¯æŒ SOCKS ä»£ç†ã€‚
5. **æœªå®‰è£… ffmpeg**ï¼šåœ¨ macOS ä¸Šæ‰§è¡Œ `brew install ffmpeg`ï¼ˆæˆ–å¯¹åº”å¹³å°çš„å®‰è£…æ–¹å¼ï¼‰ã€‚

## 5. ç›®å½•ç»“æ„ï¼ˆå…³é”®æ–‡ä»¶ï¼‰

```
.
â”œâ”€â”€ mian.py              # CLI ä¸»å…¥å£
â”œâ”€â”€ streamlit_app.py     # Web é¡µé¢
â”œâ”€â”€ requirements.txt     # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ README.md            # ä½¿ç”¨è¯´æ˜ï¼ˆæœ¬æ–‡æ¡£ï¼‰
â””â”€â”€ venv/                # è™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰
```

å¦‚æœ‰æ›´å¤šéœ€æ±‚ï¼ˆä¾‹å¦‚æ‰¹é‡å¤„ç†ã€å­—å¹•æ ·å¼æ¨¡æ¿ã€è‡ªå®šä¹‰ AI æç¤ºè¯ç­‰ï¼‰ï¼Œå¯ä»¥åŸºäºç°æœ‰ä»£ç ç»§ç»­æ‰©å±•ã€‚æ¬¢è¿åé¦ˆä½¿ç”¨ä½“éªŒï¼

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [GNU GPLv3](./LICENSE) å¼€æºåè®®ï¼Œæ¬¢è¿åœ¨éµå®ˆåè®®çš„å‰æä¸‹è‡ªç”±ä½¿ç”¨ã€å¤åˆ¶ä¸ä¿®æ”¹ä»£ç ã€‚
